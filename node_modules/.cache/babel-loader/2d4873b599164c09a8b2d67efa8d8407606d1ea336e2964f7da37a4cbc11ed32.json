{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./ReportModal.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ReportModal=_ref=>{let{isOpen,onClose,imageUrl,reportData}=_ref;const[imageError,setImageError]=useState(false);const[imageLoading,setImageLoading]=useState(true);// Reset states when modal opens/closes\nuseEffect(()=>{if(isOpen){setImageError(false);setImageLoading(true);}},[isOpen]);// Handle keyboard events (ESC to close)\nuseEffect(()=>{const handleKeyDown=e=>{if(e.key==='Escape'&&isOpen){onClose();}};if(isOpen){document.addEventListener('keydown',handleKeyDown);document.body.style.overflow='hidden';// Prevent background scroll\n}return()=>{document.removeEventListener('keydown',handleKeyDown);document.body.style.overflow='unset';// Restore scroll\n};},[isOpen,onClose]);if(!isOpen)return null;const handleOverlayClick=e=>{if(e.target===e.currentTarget){onClose();}};const handleImageLoad=()=>{setImageLoading(false);setImageError(false);};const handleImageError=()=>{setImageLoading(false);setImageError(true);};// Select best possible image URL\nconst getImageUrl=()=>{const possibleUrls=[reportData===null||reportData===void 0?void 0:reportData.file_url,reportData===null||reportData===void 0?void 0:reportData.file,imageUrl,reportData===null||reportData===void 0?void 0:reportData.image_url,reportData===null||reportData===void 0?void 0:reportData.url];for(const url of possibleUrls){if(url&&url!=='undefined'&&url!==undefined&&url.trim()!==''&&!url.includes('/undefined')&&url.startsWith('http')){return url;}}return null;};const displayUrl=getImageUrl();const handleRetry=()=>{setImageError(false);setImageLoading(true);};return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:handleOverlayClick,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Medical Report\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:onClose,\"aria-label\":\"Close modal\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[displayUrl?/*#__PURE__*/_jsxs(\"div\",{className:\"image-container\",children:[imageLoading&&!imageError&&/*#__PURE__*/_jsxs(\"div\",{className:\"loading-spinner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading image...\"})]}),imageError&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u274C Failed to Load Image\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"URL:\"}),\" \",/*#__PURE__*/_jsx(\"code\",{children:displayUrl})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"error-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleRetry,className:\"retry-button\",children:\"\\uD83D\\uDD04 Retry\"}),/*#__PURE__*/_jsx(\"a\",{href:displayUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"direct-link-button\",children:\"\\uD83D\\uDD17 Test Direct Link\"})]})]}),!imageError&&/*#__PURE__*/_jsx(\"img\",{src:displayUrl,alt:\"Medical Report\",className:\"report-image\",onLoad:handleImageLoad,onError:handleImageError,style:{display:imageLoading?'none':'block'}})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"no-image\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCCB Image Not Available\"}),!reportData?/*#__PURE__*/_jsx(\"p\",{children:\"\\u274C No report data was passed to this component.\"}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u274C The image URL is invalid or missing.\"})]}),reportData&&/*#__PURE__*/_jsxs(\"div\",{className:\"report-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCCB Report Details\"}),reportData.report_type&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Type:\"}),\" \",reportData.report_type]}),reportData.report_date&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Date:\"}),\" \",new Date(reportData.report_date).toLocaleDateString()]}),reportData.created_at&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Uploaded:\"}),\" \",new Date(reportData.created_at).toLocaleDateString()]}),reportData.first_name&&reportData.last_name&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Patient:\"}),\" \",reportData.first_name,\" \",reportData.last_name]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"close-modal-btn\",children:\"\\u274C Close\"}),displayUrl&&!imageError&&/*#__PURE__*/_jsx(\"a\",{href:displayUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"open-new-tab-btn\",children:\"\\uD83D\\uDD17 Open in New Tab\"})]})]})});};export default ReportModal;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","ReportModal","_ref","isOpen","onClose","imageUrl","reportData","imageError","setImageError","imageLoading","setImageLoading","handleKeyDown","e","key","document","addEventListener","body","style","overflow","removeEventListener","handleOverlayClick","target","currentTarget","handleImageLoad","handleImageError","getImageUrl","possibleUrls","file_url","file","image_url","url","undefined","trim","includes","startsWith","displayUrl","handleRetry","className","onClick","children","href","rel","src","alt","onLoad","onError","display","report_type","report_date","Date","toLocaleDateString","created_at","first_name","last_name"],"sources":["C:/Users/Piyush/health-app/frontend/src/components/ReportModal/ReportModal.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './ReportModal.css';\r\n\r\nconst ReportModal = ({ isOpen, onClose, imageUrl, reportData }) => {\r\n  const [imageError, setImageError] = useState(false);\r\n  const [imageLoading, setImageLoading] = useState(true);\r\n\r\n  // Reset states when modal opens/closes\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setImageError(false);\r\n      setImageLoading(true);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Handle keyboard events (ESC to close)\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (e.key === 'Escape' && isOpen) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      document.body.style.overflow = 'hidden'; // Prevent background scroll\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n      document.body.style.overflow = 'unset'; // Restore scroll\r\n    };\r\n  }, [isOpen, onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleOverlayClick = (e) => {\r\n    if (e.target === e.currentTarget) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleImageLoad = () => {\r\n    setImageLoading(false);\r\n    setImageError(false);\r\n  };\r\n\r\n  const handleImageError = () => {\r\n    setImageLoading(false);\r\n    setImageError(true);\r\n  };\r\n\r\n  // Select best possible image URL\r\n  const getImageUrl = () => {\r\n    const possibleUrls = [\r\n      reportData?.file_url,\r\n      reportData?.file,\r\n      imageUrl,\r\n      reportData?.image_url,\r\n      reportData?.url\r\n    ];\r\n\r\n    for (const url of possibleUrls) {\r\n      if (\r\n        url &&\r\n        url !== 'undefined' &&\r\n        url !== undefined &&\r\n        url.trim() !== '' &&\r\n        !url.includes('/undefined') &&\r\n        url.startsWith('http')\r\n      ) {\r\n        return url;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const displayUrl = getImageUrl();\r\n\r\n  const handleRetry = () => {\r\n    setImageError(false);\r\n    setImageLoading(true);\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={handleOverlayClick}>\r\n      <div className=\"modal-content\">\r\n        <div className=\"modal-header\">\r\n          <h3>Medical Report</h3>\r\n          <button \r\n            className=\"close-button\" \r\n            onClick={onClose}\r\n            aria-label=\"Close modal\"\r\n          >\r\n            &times;\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\">\r\n          {displayUrl ? (\r\n            <div className=\"image-container\">\r\n              {/* Loading Spinner */}\r\n              {imageLoading && !imageError && (\r\n                <div className=\"loading-spinner\">\r\n                  <div className=\"spinner\"></div>\r\n                  <p>Loading image...</p>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Error State */}\r\n              {imageError && (\r\n                <div className=\"error-message\">\r\n                  <h4>❌ Failed to Load Image</h4>\r\n                  <p><strong>URL:</strong> <code>{displayUrl}</code></p>\r\n                  \r\n                  <div className=\"error-actions\">\r\n                    <button onClick={handleRetry} className=\"retry-button\">\r\n                      🔄 Retry\r\n                    </button>\r\n                    <a \r\n                      href={displayUrl} \r\n                      target=\"_blank\" \r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"direct-link-button\"\r\n                    >\r\n                      🔗 Test Direct Link\r\n                    </a>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Actual Image */}\r\n              {!imageError && (\r\n                <img\r\n                  src={displayUrl}\r\n                  alt=\"Medical Report\"\r\n                  className=\"report-image\"\r\n                  onLoad={handleImageLoad}\r\n                  onError={handleImageError}\r\n                  style={{ display: imageLoading ? 'none' : 'block' }}\r\n                />\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"no-image\">\r\n              <h4>📋 Image Not Available</h4>\r\n              {!reportData ? (\r\n                <p>❌ No report data was passed to this component.</p>\r\n              ) : (\r\n                <p>❌ The image URL is invalid or missing.</p>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Report Information */}\r\n          {reportData && (\r\n            <div className=\"report-info\">\r\n              <h4>📋 Report Details</h4>\r\n              \r\n              {reportData.report_type && (\r\n                <p><strong>Type:</strong> {reportData.report_type}</p>\r\n              )}\r\n              \r\n              {reportData.report_date && (\r\n                <p><strong>Date:</strong> {new Date(reportData.report_date).toLocaleDateString()}</p>\r\n              )}\r\n              \r\n              {reportData.created_at && (\r\n                <p><strong>Uploaded:</strong> {new Date(reportData.created_at).toLocaleDateString()}</p>\r\n              )}\r\n              \r\n              {reportData.first_name && reportData.last_name && (\r\n                <p><strong>Patient:</strong> {reportData.first_name} {reportData.last_name}</p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"modal-footer\">\r\n          <button onClick={onClose} className=\"close-modal-btn\">\r\n            ❌ Close\r\n          </button>\r\n          \r\n          {displayUrl && !imageError && (\r\n            <a \r\n              href={displayUrl} \r\n              target=\"_blank\" \r\n              rel=\"noopener noreferrer\"\r\n              className=\"open-new-tab-btn\"\r\n            >\r\n              🔗 Open in New Tab\r\n            </a>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReportModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}